<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NexusHost | Titanium Edition</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --bg: #0f172a; --panel: #1e293b; --primary: #38bdf8; --text: #f1f5f9; }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: sans-serif; }
        body { background: var(--bg); color: var(--text); height: 100vh; overflow: hidden; display: flex; flex-direction: column; }
        
        /* EDITOR SCREEN */
        #dashboard { padding: 20px; height: 100%; display: flex; flex-direction: column; max-width: 800px; margin: 0 auto; width: 100%; }
        header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; border-bottom: 1px solid #334155; padding-bottom: 15px; }
        h1 { font-size: 1.5rem; color: var(--primary); }
        
        textarea {
            flex: 1; background: #000; color: #4ade80; border: 1px solid #334155; 
            padding: 15px; border-radius: 8px; resize: none; font-family: monospace; font-size: 14px;
        }
        
        .controls { margin-top: 15px; display: grid; gap: 10px; }
        button {
            padding: 15px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 1rem;
            display: flex; align-items: center; justify-content: center; gap: 10px;
        }
        .btn-gen { background: var(--primary); color: #000; }
        .btn-copy { background: #475569; color: #fff; display: none; } /* Hidden initially */
        
        /* VIEWER SCREEN (Iframe) */
        #viewer-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #fff; z-index: 999; display: none; }
        iframe { width: 100%; height: 100%; border: none; }
        
        #edit-btn {
            position: fixed; bottom: 20px; right: 20px; z-index: 1000;
            background: #000; color: #fff; padding: 10px 20px; border-radius: 50px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5); display: none;
        }

        .status { font-size: 0.8rem; margin-top: 5px; color: #ef4444; text-align: center; height: 20px; }
    </style>
</head>
<body>

    <!-- DASHBOARD -->
    <div id="dashboard">
        <header>
            <h1><i class="fas fa-cube"></i> NexusHost</h1>
            <span style="font-size:0.8rem; opacity:0.7">Titanium v5.0</span>
        </header>

        <textarea id="code" placeholder="Paste your HTML code here..." spellcheck="false"></textarea>
        <div class="status" id="status-msg"></div>

        <div class="controls">
            <button class="btn-gen" onclick="generateHashLink()">
                <i class="fas fa-bolt"></i> Generate Secure Link
            </button>
            <button id="copy-btn" class="btn-copy" onclick="copyToClipboard()">
                <i class="fas fa-copy"></i> Copy Link
            </button>
            <button id="open-btn" class="btn-copy" onclick="openLive()" style="background:#22c55e">
                <i class="fas fa-external-link-alt"></i> Open Site
            </button>
        </div>
    </div>

    <!-- VIEWER -->
    <div id="viewer-container">
        <iframe id="site-frame"></iframe>
        <button id="edit-btn" onclick="goHome()">✏️ Edit Code</button>
    </div>

    <script>
        // --- 1. INITIALIZATION ---
        window.addEventListener('DOMContentLoaded', () => {
            // Check if there is a Hash (#) in the URL
            if (window.location.hash && window.location.hash.length > 10) {
                renderSite();
            } else {
                // Restore draft if exists
                const draft = localStorage.getItem('nexus_draft');
                if(draft) document.getElementById('code').value = draft;
            }
        });

        // Listen for hash changes (if user clicks back button)
        window.addEventListener('hashchange', () => {
            if(!window.location.hash) {
                document.getElementById('viewer-container').style.display = 'none';
                document.getElementById('dashboard').style.display = 'flex';
            }
        });

        // --- 2. GENERATE LINK (New Hash Method) ---
        function generateHashLink() {
            const code = document.getElementById('code').value;
            const status = document.getElementById('status-msg');

            if (!code.trim()) {
                status.innerText = "Error: Code cannot be empty.";
                return;
            }

            // Save draft
            localStorage.setItem('nexus_draft', code);

            try {
                // UTF-8 to Base64 (Safe Method)
                const base64 = btoa(unescape(encodeURIComponent(code)));
                
                // Update URL with Hash (Browser won't send this to server, avoiding 414 errors)
                const newUrl = `${window.location.origin}${window.location.pathname}#${base64}`;
                
                // Show Buttons
                document.getElementById('copy-btn').style.display = 'flex';
                document.getElementById('open-btn').style.display = 'flex';
                status.style.color = '#4ade80';
                status.innerText = "Link Generated! Use 'Copy Link' button.";
                
                // Store globally for copy button
                window.generatedUrl = newUrl;

            } catch (err) {
                status.style.color = '#ef4444';
                status.innerText = "Error: Code is too large or contains invalid characters.";
            }
        }

        // --- 3. RENDER SITE ---
        function renderSite() {
            try {
                // Remove the '#' from the start
                const hash = window.location.hash.substring(1); 
                
                // Decode
                const htmlContent = decodeURIComponent(escape(atob(hash)));

                // Hide Dashboard, Show Viewer
                document.getElementById('dashboard').style.display = 'none';
                const container = document.getElementById('viewer-container');
                container.style.display = 'block';
                document.getElementById('edit-btn').style.display = 'block';

                // Inject Code
                const frame = document.getElementById('site-frame');
                const doc = frame.contentWindow.document;
                doc.open();
                doc.write(htmlContent);
                doc.close();

            } catch (e) {
                alert("Link broken or incomplete. Please recopy the full link.");
                window.location.hash = ""; // Reset
            }
        }

        // --- 4. UTILITIES ---
        function copyToClipboard() {
            if(window.generatedUrl) {
                navigator.clipboard.writeText(window.generatedUrl).then(() => {
                    alert("Link Copied! Share this with anyone.");
                });
            }
        }

        function openLive() {
            if(window.generatedUrl) {
                window.open(window.generatedUrl, '_blank');
            }
        }

        function goHome() {
            // Clears hash and reloads dashboard
            history.pushState("", document.title, window.location.pathname + window.location.search);
            document.getElementById('viewer-container').style.display = 'none';
            document.getElementById('dashboard').style.display = 'flex';
        }
    </script>
</body>
</html>
