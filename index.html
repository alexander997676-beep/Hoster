<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NexusHost v3.0 | Pro Deployment</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #6366f1;
            --primary-dark: #4338ca;
            --accent: #06b6d4;
            --bg-dark: #09090b;
            --card-bg: rgba(24, 24, 27, 0.65);
            --border: rgba(255, 255, 255, 0.08);
            --text-main: #fafafa;
            --text-muted: #a1a1aa;
            --success: #10b981;
            --danger: #ef4444;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; outline: none; }

        body {
            background-color: var(--bg-dark);
            background-image: 
                radial-gradient(circle at 0% 0%, rgba(99, 102, 241, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 100% 100%, rgba(6, 182, 212, 0.1) 0%, transparent 50%);
            color: var(--text-main);
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #18181b; }
        ::-webkit-scrollbar-thumb { background: #3f3f46; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #52525b; }

        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }

        /* --- Navbar --- */
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            margin-bottom: 30px;
            border-bottom: 1px solid var(--border);
        }

        .logo {
            font-size: 1.6rem;
            font-weight: 800;
            letter-spacing: -1px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .logo span { color: var(--primary); }
        
        .status-pill {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success);
            border: 1px solid rgba(16, 185, 129, 0.2);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .status-dot { width: 8px; height: 8px; background: var(--success); border-radius: 50%; box-shadow: 0 0 10px var(--success); }

        /* --- Grid --- */
        .main-layout {
            display: grid;
            grid-template-columns: 1.1fr 1.5fr;
            gap: 25px;
            height: calc(100vh - 120px);
        }

        @media (max-width: 1024px) {
            .main-layout { grid-template-columns: 1fr; height: auto; }
        }

        /* --- Cards --- */
        .card {
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--border);
            border-radius: 16px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }

        .card-header {
            padding: 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(255,255,255,0.02);
        }

        .card-title { font-weight: 600; font-size: 1.1rem; display: flex; align-items: center; gap: 10px; }
        .card-body { padding: 25px; flex: 1; overflow-y: auto; }

        /* --- Inputs & Forms --- */
        .input-group { margin-bottom: 20px; position: relative; }
        
        label { display: block; margin-bottom: 8px; font-size: 0.8rem; color: var(--text-muted); font-weight: 600; letter-spacing: 0.5px; }
        
        input, select {
            width: 100%;
            background: #18181b;
            border: 1px solid var(--border);
            padding: 12px 15px;
            border-radius: 8px;
            color: white;
            font-family: 'Inter', sans-serif;
            transition: 0.2s;
        }

        input:focus, select:focus { border-color: var(--primary); box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2); }

        /* --- Editor --- */
        .editor-wrapper {
            position: relative;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: #0e0e11;
            height: 400px;
            display: flex;
        }

        .line-numbers {
            width: 40px;
            background: #18181b;
            color: #52525b;
            text-align: right;
            padding: 15px 5px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 13px;
            line-height: 1.5;
            user-select: none;
            border-right: 1px solid var(--border);
        }

        textarea.code-area {
            flex: 1;
            background: transparent;
            border: none;
            color: #e4e4e7;
            padding: 15px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 13px;
            line-height: 1.5;
            resize: none;
        }

        /* --- Site List --- */
        .site-card {
            background: rgba(255,255,255,0.03);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: 0.2s;
        }

        .site-card:hover { transform: translateY(-2px); border-color: rgba(255,255,255,0.2); background: rgba(255,255,255,0.05); }

        .site-meta { display: flex; align-items: center; gap: 15px; }
        
        .site-icon {
            width: 48px;
            height: 48px;
            border-radius: 10px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: white;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }

        .site-actions { display: flex; gap: 8px; }

        .btn-icon {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            border: 1px solid var(--border);
            background: rgba(0,0,0,0.3);
            color: var(--text-muted);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: 0.2s;
        }

        .btn-icon:hover { color: white; background: rgba(255,255,255,0.1); }
        .btn-icon.danger:hover { background: rgba(239, 68, 68, 0.2); color: var(--danger); border-color: var(--danger); }

        /* --- Buttons --- */
        .btn {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover { background: var(--primary-dark); box-shadow: 0 0 15px rgba(99, 102, 241, 0.4); }

        /* --- Logs Console --- */
        .console-log {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.75rem;
            color: var(--text-muted);
            height: 120px;
            overflow-y: auto;
            border-top: 1px solid var(--border);
            padding: 15px;
            background: #000;
        }
        
        .log-entry { margin-bottom: 4px; display: flex; gap: 10px; }
        .log-time { color: #52525b; }
        .log-success { color: var(--success); }
        .log-info { color: var(--accent); }
        .log-error { color: var(--danger); }

        /* --- Modal --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8);
            backdrop-filter: blur(5px);
            z-index: 1000;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .modal {
            width: 90%;
            height: 90%;
            background: #18181b;
            border-radius: 16px;
            border: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .modal-header {
            padding: 15px 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #09090b;
        }

        .close-btn { background: none; border: none; color: white; font-size: 1.5rem; cursor: pointer; }
        iframe { width: 100%; height: 100%; border: none; background: white; }

        /* Utilities */
        .hidden { display: none !important; }
        .badge { font-size: 0.7rem; padding: 2px 6px; border-radius: 4px; background: rgba(255,255,255,0.1); }
    </style>
</head>
<body>

    <div class="container">
        <!-- Navigation -->
        <nav class="navbar">
            <div class="logo">
                <i class="fa-solid fa-cube fa-beat" style="--fa-animation-duration: 3s;"></i>
                NEXUS<span>HOST</span> <span style="font-size: 0.8rem; opacity: 0.5; font-weight: 300; margin-top: 5px;">v3.0</span>
            </div>
            <div class="status-pill">
                <div class="status-dot"></div>
                SYSTEM OPERATIONAL
            </div>
        </nav>

        <div class="main-layout">
            
            <!-- Left Panel: Creator -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title"><i class="fas fa-code"></i> Site Creator</div>
                    <select id="template-select" style="width: 150px; padding: 6px; font-size: 0.8rem;" onchange="loadTemplate()">
                        <option value="">Select Template...</option>
                        <option value="portfolio">Portfolio Card</option>
                        <option value="landing">SaaS Landing</option>
                        <option value="404">Error 404</option>
                        <option value="maintenance">Maintenance</option>
                    </select>
                </div>
                
                <div class="card-body">
                    <div class="input-group">
                        <label>PROJECT SLUG</label>
                        <input type="text" id="site-slug" placeholder="my-awesome-site" onkeyup="sanitizeSlug(this)">
                    </div>

                    <div class="input-group">
                        <label>SOURCE CODE (HTML/CSS/JS)</label>
                        <div class="editor-wrapper">
                            <div class="line-numbers" id="line-numbers">1</div>
                            <textarea id="code-editor" class="code-area" spellcheck="false" oninput="updateLineNumbers()" onkeydown="handleTab(event)"></textarea>
                        </div>
                    </div>

                    <button class="btn btn-primary" onclick="deploySite()">
                        <i class="fas fa-rocket"></i> Deploy to Network
                    </button>
                </div>
                
                <!-- System Logs -->
                <div class="console-log" id="system-log">
                    <div class="log-entry"><span class="log-time">[INIT]</span> <span class="log-info">System initialized. Ready to deploy.</span></div>
                </div>
            </div>

            <!-- Right Panel: Dashboard -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title"><i class="fas fa-server"></i> Active Deployments <span class="badge" id="count-badge">0</span></div>
                    <button class="btn-icon danger" onclick="nukeStorage()" title="Reset All Data"><i class="fas fa-bomb"></i></button>
                </div>
                
                <div class="card-body" id="sites-list">
                    <!-- Sites injected here -->
                    <div style="text-align: center; padding: 60px; opacity: 0.5;">
                        <i class="fas fa-network-wired" style="font-size: 3rem; margin-bottom: 20px;"></i>
                        <p>No active deployments found on local node.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Preview Modal -->
    <div class="modal-overlay" id="preview-modal">
        <div class="modal">
            <div class="modal-header">
                <div class="card-title" id="preview-title">Preview</div>
                <div style="display:flex; gap:10px">
                    <button class="btn-icon" onclick="openExternal()" title="Open in New Tab"><i class="fas fa-external-link-alt"></i></button>
                    <button class="close-btn" onclick="closePreview()">&times;</button>
                </div>
            </div>
            <iframe id="preview-frame" sandbox="allow-scripts allow-same-origin allow-modals"></iframe>
        </div>
    </div>

    <script>
        // --- State Management ---
        let sites = [];
        let currentPreviewUrl = '';

        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            loadFromStorage();
            updateLineNumbers();
            
            // Set default text if empty
            if(!document.getElementById('code-editor').value) {
                document.getElementById('code-editor').value = `<!DOCTYPE html>
<html lang="en">
<head>
    <style>
        body { font-family: sans-serif; display: grid; place-items: center; height: 100vh; background: #111; color: #fff; }
        h1 { background: linear-gradient(to right, #6366f1, #06b6d4); -webkit-background-clip: text; color: transparent; }
    </style>
</head>
<body>
    <div style="text-align:center">
        <h1>Hello Nexus!</h1>
        <p>Edit me and click Deploy.</p>
    </div>
</body>
</html>`;
                updateLineNumbers();
            }
        });

        // --- Core Functions ---

        function deploySite() {
            const slugInput = document.getElementById('site-slug');
            const codeInput = document.getElementById('code-editor');
            
            let name = slugInput.value || 'untitled-' + Math.floor(Math.random()*1000);
            const content = codeInput.value;

            if(!content.trim()) {
                log('Cannot deploy empty shell.', 'error');
                return;
            }

            // Check if site exists, if so update it
            const existingIndex = sites.findIndex(s => s.name === name);
            const isUpdate = existingIndex !== -1;

            if (isUpdate) {
                sites[existingIndex].content = content;
                sites[existingIndex].lastUpdated = new Date().toLocaleString();
                // Regenerate URL
                if(sites[existingIndex].blobUrl) URL.revokeObjectURL(sites[existingIndex].blobUrl);
                sites[existingIndex].blobUrl = createBlobUrl(content);
                log(`Deployment [${name}] updated successfully.`, 'success');
            } else {
                const newSite = {
                    id: Date.now(),
                    name: name,
                    content: content,
                    created: new Date().toLocaleDateString(),
                    lastUpdated: new Date().toLocaleString(),
                    views: 0,
                    blobUrl: createBlobUrl(content)
                };
                sites.unshift(newSite);
                log(`New instance [${name}] deployed.`, 'success');
            }

            saveToStorage();
            renderSites();
            
            // UI Feedback
            slugInput.value = '';
        }

        function createBlobUrl(content) {
            const blob = new Blob([content], {type: 'text/html'});
            return URL.createObjectURL(blob);
        }

        // --- Persistence (The Upgrade) ---
        function saveToStorage() {
            try {
                // We save the CONTENT, not the Blob URL
                const dataToSave = sites.map(s => ({
                    id: s.id,
                    name: s.name,
                    content: s.content,
                    created: s.created,
                    views: s.views
                }));
                localStorage.setItem('nexus_v3_sites', JSON.stringify(dataToSave));
            } catch (e) {
                log('Storage Quota Exceeded! Site deployed but not saved persistently.', 'error');
            }
        }

        function loadFromStorage() {
            const data = localStorage.getItem('nexus_v3_sites');
            if(data) {
                const storedSites = JSON.parse(data);
                // Regenerate Blobs for every site
                sites = storedSites.map(s => ({
                    ...s,
                    blobUrl: createBlobUrl(s.content)
                }));
                log(`Restored ${sites.length} active deployments from local node.`, 'info');
                renderSites();
            }
        }

        function nukeStorage() {
            if(confirm('WARNING: This will wipe all deployed sites from local storage. Continue?')) {
                localStorage.removeItem('nexus_v3_sites');
                sites = [];
                renderSites();
                log('System storage formatted.', 'error');
            }
        }

        // --- Rendering ---
        function renderSites() {
            const container = document.getElementById('sites-list');
            document.getElementById('count-badge').innerText = sites.length;
            
            if (sites.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 60px; opacity: 0.5;">
                        <i class="fas fa-network-wired" style="font-size: 3rem; margin-bottom: 20px;"></i>
                        <p>No active deployments found.</p>
                    </div>`;
                return;
            }

            container.innerHTML = '';
            sites.forEach(site => {
                const div = document.createElement('div');
                div.className = 'site-card';
                div.innerHTML = `
                    <div class="site-meta">
                        <div class="site-icon"><i class="fas fa-globe"></i></div>
                        <div>
                            <div style="font-weight:700; font-size:1rem;">${site.name}</div>
                            <div style="color:var(--text-muted); font-size:0.75rem;">
                                <i class="far fa-clock"></i> ${site.created} â€¢ <i class="far fa-eye"></i> ${site.views}
                            </div>
                        </div>
                    </div>
                    <div class="site-actions">
                        <button class="btn-icon" onclick="previewSite(${site.id})" title="Preview"><i class="fas fa-play"></i></button>
                        <button class="btn-icon" onclick="editSite(${site.id})" title="Edit Source"><i class="fas fa-pen"></i></button>
                        <button class="btn-icon danger" onclick="deleteSite(${site.id})" title="Terminate"><i class="fas fa-trash"></i></button>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        // --- Actions ---
        function deleteSite(id) {
            sites = sites.filter(s => s.id !== id);
            saveToStorage();
            renderSites();
            log('Instance terminated.', 'info');
        }

        function editSite(id) {
            const site = sites.find(s => s.id === id);
            if(site) {
                document.getElementById('site-slug').value = site.name;
                document.getElementById('code-editor').value = site.content;
                updateLineNumbers();
                log(`Source code for [${site.name}] loaded into editor.`, 'info');
            }
        }

        function previewSite(id) {
            const site = sites.find(s => s.id === id);
            if(site) {
                // Increment fictitious view count
                site.views += Math.floor(Math.random() * 5) + 1;
                saveToStorage();
                renderSites();

                currentPreviewUrl = site.blobUrl;
                document.getElementById('preview-title').innerText = `Previewing: ${site.name}`;
                document.getElementById('preview-frame').src = site.blobUrl;
                document.getElementById('preview-modal').style.display = 'flex';
            }
        }

        function closePreview() {
            document.getElementById('preview-modal').style.display = 'none';
            document.getElementById('preview-frame').src = '';
        }

        function openExternal() {
            if(currentPreviewUrl) window.open(currentPreviewUrl, '_blank');
        }

        // --- Templates ---
        const templates = {
            'portfolio': `<!DOCTYPE html>
<html lang="en">
<head>
    <style>
        body { background: #111; color: white; font-family: sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .card { background: #222; padding: 40px; border-radius: 20px; text-align: center; border: 1px solid #333; max-width: 300px; }
        img { width: 100px; height: 100px; border-radius: 50%; object-fit: cover; margin-bottom: 20px; border: 2px solid #6366f1; }
        h2 { margin: 0; color: #fff; }
        p { color: #888; }
        .btn { display: inline-block; margin-top: 20px; padding: 10px 20px; background: #6366f1; color: white; text-decoration: none; border-radius: 5px; }
    </style>
</head>
<body>
    <div class="card">
        <img src="https://ui-avatars.com/api/?name=User&background=random" alt="Profile">
        <h2>Dev One</h2>
        <p>Full Stack Developer building things for the web.</p>
        <a href="#" class="btn">Contact Me</a>
    </div>
</body>
</html>`,
            'landing': `<!DOCTYPE html>
<html lang="en">
<head>
    <style>
        body { margin: 0; font-family: system-ui; background: linear-gradient(135deg, #1e1b4b 0%, #312e81 100%); color: white; }
        .hero { text-align: center; padding: 100px 20px; }
        h1 { font-size: 4rem; margin-bottom: 10px; background: -webkit-linear-gradient(#eee, #999); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        p { font-size: 1.2rem; color: #a5b4fc; max-width: 600px; margin: 0 auto 30px; }
        button { background: #4f46e5; color: white; border: none; padding: 15px 30px; font-size: 1rem; border-radius: 50px; cursor: pointer; font-weight: bold; }
        button:hover { transform: scale(1.05); transition: 0.2s; }
    </style>
</head>
<body>
    <div class="hero">
        <h1>SaaS Future</h1>
        <p>The next generation of cloud computing is here. Deploy in seconds, scale infinitely.</p>
        <button>Get Started Free</button>
    </div>
</body>
</html>`,
            '404': `<!DOCTYPE html>
<html lang="en">
<head>
    <style>
        body { height: 100vh; background: #000; color: #ef4444; display: flex; flex-direction: column; justify-content: center; align-items: center; font-family: monospace; }
        h1 { font-size: 8rem; margin: 0; }
        p { font-size: 1.5rem; color: #666; }
    </style>
</head>
<body>
    <h1>404</h1>
    <p>SYSTEM FAILURE: RESOURCE NOT FOUND</p>
</body>
</html>`
        };

        function loadTemplate() {
            const select = document.getElementById('template-select');
            const val = select.value;
            if(templates[val]) {
                document.getElementById('code-editor').value = templates[val];
                updateLineNumbers();
                log(`Template [${val}] loaded.`, 'info');
                select.value = ""; // Reset
            }
        }

        // --- Utility ---
        function log(msg, type = 'info') {
            const console = document.getElementById('system-log');
            const time = new Date().toLocaleTimeString().split(' ')[0];
            const div = document.createElement('div');
            div.className = 'log-entry';
            div.innerHTML = `<span class="log-time">[${time}]</span> <span class="log-${type}">${msg}</span>`;
            console.appendChild(div);
            console.scrollTop = console.scrollHeight;
        }

        function sanitizeSlug(input) {
            input.value = input.value.toLowerCase().replace(/[^a-z0-9-]/g, '');
        }

        function handleTab(e) {
            if (e.key === 'Tab') {
                e.preventDefault();
                document.execCommand('insertText', false, '    ');
            }
        }

        function updateLineNumbers() {
            const textarea = document.getElementById('code-editor');
            const lines = textarea.value.split('\n').length;
            const lineNumbers = document.getElementById('line-numbers');
            lineNumbers.innerHTML = Array(lines).fill(0).map((_, i) => i + 1).join('<br>');
        }
    </script>
</body>
</html>
