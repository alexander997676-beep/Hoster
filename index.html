<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NexusHost | Custom Name Edition</title>
    
    <!-- Libraries -->
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600&family=JetBrains+Mono:wght@400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.4.4/lz-string.min.js"></script>

    <style>
        :root {
            --bg: #0f172a; --card: #1e293b; --primary: #6366f1; --text: #f8fafc; --border: #334155;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; outline: none; }
        
        body {
            background: var(--bg); color: var(--text); font-family: 'Outfit', sans-serif;
            height: 100vh; overflow: hidden; display: flex; flex-direction: column;
        }

        /* --- EDITOR SCREEN --- */
        #editor-screen {
            display: flex; flex-direction: column; height: 100%; max-width: 1000px; margin: 0 auto; width: 100%; padding: 15px;
        }

        header {
            display: flex; align-items: center; justify-content: space-between; padding-bottom: 15px; border-bottom: 1px solid var(--border); margin-bottom: 15px;
        }
        .logo { font-weight: 700; font-size: 1.2rem; color: var(--primary); display: flex; gap: 8px; align-items: center; }

        /* INPUT GROUPS */
        .input-group { margin-bottom: 15px; }
        .input-group label { display: block; font-size: 0.8rem; color: #94a3b8; margin-bottom: 5px; font-weight: 600; }
        
        input[type="text"] {
            width: 100%; background: #000; border: 1px solid var(--border); color: #fff;
            padding: 12px; border-radius: 8px; font-family: 'Outfit', sans-serif;
        }
        
        textarea {
            flex: 1; width: 100%; background: #000; border: 1px solid var(--border); color: #a5b4fc;
            padding: 15px; border-radius: 8px; font-family: 'JetBrains Mono', monospace; resize: none;
        }
        
        input:focus, textarea:focus { border-color: var(--primary); }

        /* BUTTONS */
        .controls { display: flex; gap: 10px; margin-top: 15px; }
        .btn {
            flex: 1; padding: 12px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;
            display: flex; align-items: center; justify-content: center; gap: 8px; transition: 0.2s;
        }
        .btn-primary { background: var(--primary); color: white; }
        .btn-secondary { background: var(--card); color: white; border: 1px solid var(--border); }
        .btn:hover { opacity: 0.9; transform: translateY(-2px); }

        /* --- VIEWER (IFRAME) --- */
        #viewer-container {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: white; z-index: 1000; display: none;
        }
        iframe { width: 100%; height: 100%; border: none; }
        
        #edit-fab {
            position: fixed; bottom: 20px; right: 20px; z-index: 1100;
            background: #000; color: #fff; padding: 10px 20px; border-radius: 30px;
            cursor: pointer; box-shadow: 0 5px 15px rgba(0,0,0,0.3); display: none;
        }

        /* --- MODAL --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); z-index: 2000; display: none;
            justify-content: center; align-items: center;
        }
        .modal {
            background: var(--card); padding: 25px; border-radius: 12px; width: 90%; max-width: 400px;
            text-align: center; border: 1px solid var(--border);
        }
        .link-box {
            background: #000; padding: 10px; border-radius: 6px; color: var(--primary);
            font-family: monospace; word-break: break-all; margin: 15px 0; font-size: 0.9rem;
        }
        .loader {
            width: 20px; height: 20px; border: 3px solid #FFF; border-bottom-color: transparent;
            border-radius: 50%; display: inline-block; animation: rotation 1s linear infinite;
        }
        @keyframes rotation { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

    </style>
</head>
<body>

    <!-- EDITOR UI -->
    <div id="editor-screen">
        <header>
            <div class="logo"><i class="fas fa-server"></i> NEXUS HOST</div>
            <div style="font-size: 0.75rem; color: #64748b;">v9.0 Custom</div>
        </header>

        <!-- 1. Custom Name Input -->
        <div class="input-group">
            <label>WEBSITE NAME (For URL & Title)</label>
            <input type="text" id="site-name" placeholder="e.g. My-Cool-Game" autocomplete="off">
        </div>

        <!-- 2. Code Input -->
        <div class="input-group" style="flex: 1; display: flex; flex-direction: column;">
            <label>SOURCE CODE (HTML)</label>
            <textarea id="code-editor" placeholder="<html>...Paste here...</html>" spellcheck="false"></textarea>
        </div>

        <!-- 3. Action Buttons -->
        <div class="controls">
            <button class="btn btn-primary" onclick="generateCustomLink()">
                <i class="fas fa-bolt"></i> Generate Short Link
            </button>
            <button class="btn btn-secondary" onclick="previewSite()">
                <i class="fas fa-play"></i> Preview
            </button>
        </div>
    </div>

    <!-- SHARE MODAL -->
    <div class="modal-overlay" id="modal">
        <div class="modal">
            <h3 style="margin-bottom: 10px;">Link Ready! ðŸš€</h3>
            <p style="font-size: 0.85rem; color: #94a3b8;">Your custom name site is live.</p>
            
            <div class="link-box" id="short-link">Generating...</div>
            
            <button class="btn btn-primary" onclick="copyLink()">Copy Link</button>
            <button class="btn btn-secondary" style="margin-top: 10px;" onclick="closeModal()">Close</button>
        </div>
    </div>

    <!-- VIEWER UI -->
    <div id="viewer-container">
        <iframe id="site-frame"></iframe>
        <button id="edit-fab" onclick="closeViewer()"><i class="fas fa-pen"></i> Edit</button>
    </div>

    <script>
        // --- ON LOAD ---
        window.onload = function() {
            const params = new URLSearchParams(window.location.search);
            const siteName = params.get('site'); // Check for ?site=Name
            const hash = window.location.hash.substring(1);

            if (hash) {
                // VIEW MODE
                // 1. Set Title to Custom Name
                if(siteName) {
                    document.title = siteName; 
                }
                // 2. Render Site
                try {
                    const content = LZString.decompressFromEncodedURIComponent(hash);
                    if(content) showViewer(content);
                } catch(e) {}
            } else {
                // EDIT MODE - Load Draft
                const draft = localStorage.getItem('nexus_draft_v9');
                if(draft) document.getElementById('code-editor').value = draft;
            }
        };

        // --- GENERATE LINK ---
        async function generateCustomLink() {
            const nameInput = document.getElementById('site-name').value.trim();
            const code = document.getElementById('code-editor').value;

            if(!code) { alert("Code is empty!"); return; }
            
            // Default name if empty
            const safeName = nameInput ? nameInput.replace(/[^a-zA-Z0-9-_]/g, '-') : "My-Site";
            
            // Show Loader
            const modal = document.getElementById('modal');
            const linkBox = document.getElementById('short-link');
            modal.style.display = 'flex';
            linkBox.innerHTML = '<span class="loader"></span>';

            // 1. Create Long URL with ?site=NAME parameter
            const compressed = LZString.compressToEncodedURIComponent(code);
            // This structure: domain.com/?site=Name#code
            const longUrl = `${window.location.origin}${window.location.pathname}?site=${safeName}#${compressed}`;

            // 2. Shorten with TinyURL
            try {
                const apiUrl = `https://tinyurl.com/api-create.php?url=${encodeURIComponent(longUrl)}`;
                // Using proxy to avoid CORS
                const response = await fetch(`https://api.allorigins.win/raw?url=${encodeURIComponent(apiUrl)}`);
                
                if(!response.ok) throw new Error("API Failed");
                
                const shortUrl = await response.text();
                linkBox.innerText = shortUrl;
                
                // Save Draft
                localStorage.setItem('nexus_draft_v9', code);

            } catch (e) {
                // Fallback if shortener fails
                linkBox.innerText = "Error shortening. Copy long link from address bar after preview.";
                alert("Could not shorten link (Code too big).");
                modal.style.display = 'none';
            }
        }

        // --- PREVIEW ---
        function previewSite() {
            const code = document.getElementById('code-editor').value;
            const name = document.getElementById('site-name').value || "Preview";
            document.title = name; // Update Browser Tab Name
            showViewer(code);
        }

        function showViewer(content) {
            document.getElementById('editor-screen').style.display = 'none';
            const container = document.getElementById('viewer-container');
            container.style.display = 'block';
            document.getElementById('edit-fab').style.display = 'block';

            const doc = document.getElementById('site-frame').contentWindow.document;
            doc.open();
            doc.write(content);
            doc.close();
        }

        function closeViewer() {
            // Reset URL clean
            history.pushState("", document.title, window.location.pathname);
            window.location.reload();
        }

        // --- UTILS ---
        function copyLink() {
            const txt = document.getElementById('short-link').innerText;
            navigator.clipboard.writeText(txt).then(() => alert("Copied!"));
        }
        function closeModal() {
            document.getElementById('modal').style.display = 'none';
        }

    </script>
</body>
</html>
